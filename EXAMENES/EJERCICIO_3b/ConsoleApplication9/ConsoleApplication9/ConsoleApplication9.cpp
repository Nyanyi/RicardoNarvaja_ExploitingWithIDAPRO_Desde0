// ConsoleApplication9.cpp: define el punto de entrada de la aplicaci√≥n de consola.
//

#include "stdafx.h"
#include <stdio.h>
#include <string.h>
#include <windows.h>
#include <WinBase.h>

class MyClass
{
	
public:
	MyClass(int edad);
	~MyClass();
	virtual void print(MyClass * __pepe);
	char * buf;
	int size;
	MyClass * inst[20];
	int m_edad;
private:
	
	
};

MyClass::MyClass(int edad)
{
	m_edad = edad;
	buf = (char *) malloc(edad);
}


MyClass::~MyClass()
{
}

void MyClass::print(MyClass * __pepe) {
	for (int i = 0; i < 20; i++) {
		printf("Salida %s\n", (char *)__pepe->inst[2]->buf);
	}

}

void saluda(MyClass * _pepe) {

	_pepe->inst[3]->print( _pepe);

}

int main(int argc, char **argv) {



	FILE * file_pepe = fopen("pepe.bin", "rb");

	if (file_pepe == 0) {exit(1); }

	
		
	LoadLibraryA("Mypepe.dll");
	

	MyClass pepe(20) ;


	char readed[20];


	for (int i = 0; i <20; i++) {
		size_t result = fread(readed, 1, 2, file_pepe);
		if (result != 2) { exit(1); }
		int value = atoi(readed);

		pepe.inst[i] =  new MyClass(value);
		fread((char *)pepe.inst[i]->buf, 1,pepe.inst[i]->m_edad,file_pepe);
		if (pepe.inst[i]->m_edad == 54) {
			delete (pepe.inst[i]);
			delete (pepe.inst[i-1]);
		}

	}
	
	saluda(&pepe);
	return 0;
}


